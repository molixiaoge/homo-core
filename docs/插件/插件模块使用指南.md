# æ’ä»¶æ¨¡å—ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

homo-core æ’ä»¶æ¨¡å—æä¾›äº†å¼ºå¤§çš„ Maven æ’ä»¶åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä¸€é”®éƒ¨ç½²åˆ° K8S ç¯å¢ƒå’Œä¸€é”®å¯¼è¡¨å·¥å…·ï¼Œå¤§å¤§ç®€åŒ–äº†æ¸¸æˆæœåŠ¡å™¨çš„å¼€å‘å’Œéƒ¨ç½²æµç¨‹ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **ä¸€é”®éƒ¨ç½²**: è‡ªåŠ¨ç”Ÿæˆ K8S éƒ¨ç½²æ–‡ä»¶ï¼Œæ”¯æŒæœ‰çŠ¶æ€å’Œæ— çŠ¶æ€æœåŠ¡
- ğŸ“Š **ä¸€é”®å¯¼è¡¨**: ä» Excel é…ç½®è¡¨è‡ªåŠ¨ç”Ÿæˆ Java ç±»å’Œ JSON æ•°æ®æ–‡ä»¶
- ğŸ”§ **çµæ´»é…ç½®**: æ”¯æŒå¤šç§é…ç½®ç­–ç•¥å’Œè‡ªå®šä¹‰æ¨¡æ¿
- ğŸŒ **å¤šç¯å¢ƒæ”¯æŒ**: æ”¯æŒå¼€å‘ã€æµ‹è¯•ã€ç”Ÿäº§ç¯å¢ƒé…ç½®

## ç¯å¢ƒè¦æ±‚

- **JDK**: 8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Maven**: 3.6.0 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Apollo é…ç½®ä¸­å¿ƒ**: ç”¨äºé…ç½®ç®¡ç†
- **K8S é›†ç¾¤**: ç”¨äºæœåŠ¡éƒ¨ç½²

### Apollo é…ç½®

åœ¨ `C:/opt/settings` (Windows) æˆ– `/opt/settings` (Linux) é…ç½® `server.properties`:

```properties
apollo.meta=http://192.168.10.142:28080 
env=PRO
idc=dev-dubian
```

## å¿«é€Ÿå¼€å§‹

### 1. æ·»åŠ æ’ä»¶ä¾èµ–

åœ¨é¡¹ç›®çš„ `pom.xml` ä¸­æ·»åŠ æ’ä»¶ï¼š

```xml
<plugin>
    <groupId>com.homo</groupId>
    <artifactId>homo-maven-plugin</artifactId>
    <version>${homo.core.version}</version>
    <executions>
        <execution>
            <goals>
                <goal>homoBuild</goal>
                <goal>homoDeploy</goal>
                <goal>homoClean</goal>
            </goals>
        </execution>
    </executions>
</plugin>
```

### 2. æ‰§è¡Œéƒ¨ç½²å‘½ä»¤

```bash
# æ„å»ºéƒ¨ç½²æ–‡ä»¶
mvn homo:homoBuild

# éƒ¨ç½²åˆ° K8S
mvn homo:homoDeploy

# æ¸…ç†ç”Ÿæˆçš„æ–‡ä»¶
mvn homo:homoClean
```

## è¯¦ç»†åŠŸèƒ½

### ä¸€é”®éƒ¨ç½²åŠŸèƒ½ (homoBuild)

#### åŠŸèƒ½è¯´æ˜
è‡ªåŠ¨ç”Ÿæˆ K8S éƒ¨ç½²æ–‡ä»¶ï¼ŒåŒ…æ‹¬ï¼š
- `Deployment.yaml` (æ— çŠ¶æ€æœåŠ¡)
- `StatefulSet.yaml` (æœ‰çŠ¶æ€æœåŠ¡)
- `Service.yaml` (æœåŠ¡é…ç½®)

#### é…ç½®å‚æ•°

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `local.debug` | è°ƒè¯•æ¨¡å¼ï¼Œåªéƒ¨ç½² service å¹¶è½¬å‘æµé‡åˆ°æœ¬åœ° | false |
| `local.ip` | è°ƒè¯•æ¨¡å¼è½¬å‘åœ°å€ | "" |
| `server.scan.path` | æœåŠ¡æ‰«æè·¯å¾„ | com.homo |
| `kube.cert.config` | K8S é…ç½®ä¿¡æ¯ | "" |
| `kube.cert.config.file` | K8S é…ç½®æ–‡ä»¶è·¯å¾„ | "" |

#### ä½¿ç”¨ç¤ºä¾‹

```xml
<plugin>
    <groupId>com.homo</groupId>
    <artifactId>homo-maven-plugin</artifactId>
    <version>${homo.core.version}</version>
    <configuration>
        <local.debug>false</local.debug>
        <server.scan.path>com.homo</server.scan.path>
        <kube.cert.config.file>/path/to/kubeconfig</kube.cert.config.file>
    </configuration>
</plugin>
```

### ä¸€é”®å¯¼è¡¨åŠŸèƒ½ (homoTurnTable)

#### åŠŸèƒ½è¯´æ˜
ä» Excel é…ç½®è¡¨è‡ªåŠ¨ç”Ÿæˆï¼š
- Java æ•°æ®ç±»
- JSON é…ç½®æ–‡ä»¶
- æ”¯æŒå¤šç§æ•°æ®ç±»å‹å’Œæ ‡è®°

#### æ”¯æŒçš„æ•°æ®ç±»å‹

| ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `int` | æ•´å‹ | 100 |
| `string` | å­—ç¬¦ä¸² | "hello" |
| `bool` | å¸ƒå°”ç±»å‹ | true/false |
| `float` | æµ®ç‚¹å‹ | 3.14 |
| `long` | é•¿æ•´å‹ | 1234567890L |
| `eTimeType` | æšä¸¾ç±»å‹ (eå¼€å¤´) | eTimeType |
| `Map<T>` | æ˜ å°„ç±»å‹ | Map<String, Integer> |
| `List<T>` | åˆ—è¡¨ç±»å‹ | List<String> |
| `JSON` | JSON å¯¹è±¡ | {"key": "value"} |

#### å­—æ®µæ ‡è®°è¯´æ˜

| æ ‡è®° | è¯´æ˜ |
|------|------|
| `S` | æœåŠ¡å™¨éœ€è¦çš„å­—æ®µ |
| `C` | å®¢æˆ·ç«¯éœ€è¦çš„å­—æ®µ |
| `A` | æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½éœ€è¦çš„å­—æ®µ |
| `K` | ä¸»é”®å­—æ®µ (å¿…é¡»æ˜¯ int ç±»å‹) |
| `N` | ä¸éœ€è¦è¯»å–çš„æ•°æ® |

#### é…ç½®ç¤ºä¾‹

```xml
<plugin>
    <groupId>com.homo</groupId>
    <artifactId>homo-maven-plugin</artifactId>
    <version>${homo.core.version}</version>
    <executions>
        <execution>
            <id>homoTurnTable</id>
            <goals>
                <goal>homoTurnTable</goal>
            </goals>
            <configuration>
                <fltPath>E:\homo-game\Turn_table\ftl</fltPath>
                <javaPath>E:\homo-game\src\main\java\com\homo\data</javaPath>
                <packageName>com.homo.data</packageName>
                <dataPath>E:\homo-game\Turn_table\config</dataPath>
                <jsonPath>E:\homo-game\src\main\resources\json</jsonPath>
                <codeType>.java</codeType>
                <filter>S</filter>
                <suffix>xlsx</suffix>
            </configuration>
        </execution>
    </executions>
</plugin>
```

#### ç”Ÿæˆçš„ä»£ç ç¤ºä¾‹

**Java ç±»:**
```java
@Component
public class Table_ActivityInfo {
    private final static Logger logger = LoggerFactory.getLogger(Table_ActivityInfo.class);
    
    @Data
    public static class Record_ActivityInfo {
        public int __ROW_INDEX__;
        public final Integer index;
        public final String actId;
        public final Integer actType;
        // ... å…¶ä»–å­—æ®µ
        
        public String getKey__tpf() {
            return index + "";
        }
    }
    
    public void load() {
        // åŠ è½½ JSON é…ç½®æ•°æ®
    }
}
```

**JSON é…ç½®:**
```json
{
  "__META_INFO__": [
    {
      "1": "index",
      "2": "actId",
      "3": "actType"
    },
    {
      "1": "int",
      "2": "string", 
      "3": "int"
    }
  ],
  "1": {
    "index": 1,
    "actId": "1",
    "actType": 1
  }
}
```

## æœ€ä½³å®è·µ

### 1. é…ç½®è¡¨è®¾è®¡
- ä½¿ç”¨æ¸…æ™°çš„è¡Œæ ‡é¢˜å’Œæ•°æ®ç±»å‹å®šä¹‰
- åˆç†ä½¿ç”¨å­—æ®µæ ‡è®° (S/C/A/K)
- ä¿æŒé…ç½®è¡¨ç»“æ„çš„ä¸€è‡´æ€§

### 2. éƒ¨ç½²é…ç½®
- æ ¹æ®æœåŠ¡ç±»å‹é€‰æ‹©åˆé€‚çš„éƒ¨ç½²æ–¹å¼
- åˆç†é…ç½®èµ„æºé™åˆ¶å’Œå‰¯æœ¬æ•°é‡
- ä½¿ç”¨ ConfigMap å’Œ Secret ç®¡ç†é…ç½®

### 3. å¼€å‘æµç¨‹
- å…ˆè®¾è®¡é…ç½®è¡¨ç»“æ„
- ä½¿ç”¨å¯¼è¡¨åŠŸèƒ½ç”Ÿæˆä»£ç 
- æœ¬åœ°æµ‹è¯•é€šè¿‡åéƒ¨ç½²åˆ° K8S

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Apollo é…ç½®åŠ è½½å¤±è´¥**
   - æ£€æŸ¥ `server.properties` æ–‡ä»¶è·¯å¾„å’Œå†…å®¹
   - ç¡®è®¤ Apollo æœåŠ¡åœ°å€å¯è®¿é—®

2. **K8S éƒ¨ç½²å¤±è´¥**
   - æ£€æŸ¥ K8S é›†ç¾¤è¿æ¥çŠ¶æ€
   - éªŒè¯é…ç½®æ–‡ä»¶æƒé™å’Œæ ¼å¼

3. **å¯¼è¡¨ç”Ÿæˆå¤±è´¥**
   - æ£€æŸ¥ Excel æ–‡ä»¶æ ¼å¼å’Œè·¯å¾„
   - ç¡®è®¤ Java åŒ…åå’Œè·¯å¾„é…ç½®æ­£ç¡®

### è°ƒè¯•æŠ€å·§

- å¯ç”¨ `local.debug` æ¨¡å¼è¿›è¡Œæœ¬åœ°è°ƒè¯•
- æŸ¥çœ‹ç”Ÿæˆçš„ YAML æ–‡ä»¶å†…å®¹
- æ£€æŸ¥ Maven æ—¥å¿—è¾“å‡º

## ç›¸å…³é“¾æ¥

- [homo-core æ¡†æ¶æ–‡æ¡£](../README.md)
- [K8S éƒ¨ç½²æœ€ä½³å®è·µ](https://kubernetes.io/docs/concepts/workloads/)
- [Maven æ’ä»¶å¼€å‘æŒ‡å—](https://maven.apache.org/guides/plugin/guide-java-plugin-development.html)
