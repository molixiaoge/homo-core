# å®ä½“æ¨¡å—ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

homo-core å®ä½“æ¨¡å—åŸºäºé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼ˆDDDï¼‰ç†å¿µï¼Œæä¾›äº†æœ‰çŠ¶æ€ã€å¯è¿œç¨‹è°ƒç”¨ã€è‡ªå­˜å‚¨çš„å®ä½“å¯¹è±¡èƒ½åŠ›ã€‚å®ä½“æ˜¯æ¸¸æˆæœåŠ¡å™¨ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œä»£è¡¨ç©å®¶ã€è§’è‰²ã€ç‰©å“ç­‰æ¸¸æˆå¯¹è±¡ï¼Œå…·å¤‡è‡ªåŠ¨å­˜å‚¨ã€è¿œç¨‹è°ƒç”¨ã€æœ¬åœ°ç¼“å­˜ç­‰ç‰¹æ€§ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ® **æœ‰çŠ¶æ€å®ä½“**: æ”¯æŒåŸºäºå®ä½“IDçš„æœ‰çŠ¶æ€æœåŠ¡è°ƒç”¨
- ğŸ”„ **è‡ªåŠ¨å­˜å‚¨**: å®ä½“æ•°æ®è‡ªåŠ¨è½åœ°åˆ°æ•°æ®åº“
- ğŸ“ **è¿œç¨‹è°ƒç”¨**: æ”¯æŒè·¨æœåŠ¡çš„å®ä½“æ–¹æ³•è°ƒç”¨
- ğŸ’¾ **æœ¬åœ°ç¼“å­˜**: å®ä½“æ•°æ®æœ¬åœ°ç¼“å­˜ï¼Œæé«˜è®¿é—®æ€§èƒ½
- âš¡ **å“åº”å¼**: åŸºäºå“åº”å¼ç¼–ç¨‹ï¼Œæ”¯æŒé«˜å¹¶å‘æ“ä½œ
- ğŸ›¡ï¸ **ç±»å‹å®‰å…¨**: å¼ºç±»å‹å®ä½“å®šä¹‰ï¼Œç¼–è¯‘æ—¶æ£€æŸ¥

## ç¯å¢ƒè¦æ±‚

- **JDK**: 8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **MySQL**: 5.7 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆç”¨äºæ•°æ®æŒä¹…åŒ–ï¼‰
- **Redis**: 3.0 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆç”¨äºç¼“å­˜å’ŒçŠ¶æ€å­˜å‚¨ï¼‰
- **K8S**: ç”¨äºæœ‰çŠ¶æ€æœåŠ¡éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

## å¿«é€Ÿå¼€å§‹

### 1. æ·»åŠ ä¾èµ–

```xml
<dependencies>
    <!-- å®ä½“èƒ½åŠ›æ¨¡å— -->
    <dependency>
        <groupId>com.homo</groupId>
        <artifactId>homo-core-entity-ability</artifactId>
    </dependency>
    
    <!-- å­˜å‚¨æ¨¡å— -->
    <dependency>
        <groupId>com.homo</groupId>
        <artifactId>homo-core-storage</artifactId>
    </dependency>
    
    <!-- RPC æ¨¡å— -->
    <dependency>
        <groupId>com.homo</groupId>
        <artifactId>homo-core-rpc-server</artifactId>
    </dependency>
</dependencies>
```

### 2. å®šä¹‰å®ä½“æ¥å£

```java
// ç”¨æˆ·å®ä½“æ¥å£
@EntityType(type = "user-entity")
@StorageTime(10000)  // 10ç§’è½åœ°ä¸€æ¬¡
@CacheTime(20000)    // 20ç§’ç¼“å­˜æ—¶é—´
public interface UserEntityFacade {
    
    /**
     * æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
     */
    Homo<QueryUserInfoResp> queryUserInfo(QueryUserInfoReq request);
    
    /**
     * è¿›å…¥æ¸¸æˆ
     */
    Homo<EnterGameResp> enterGame(EnterGameReq request);
    
    /**
     * ç¦»å¼€æ¸¸æˆ
     */
    Homo<LeaveGameResp> leaveGame(LeaveGameReq request);
    
    /**
     * æ›´æ–°ç”¨æˆ·ç­‰çº§
     */
    Homo<UpdateLevelResp> updateLevel(UpdateLevelReq request);
    
    /**
     * æ·»åŠ ç‰©å“
     */
    Homo<AddItemResp> addItem(AddItemReq request);
}
```

### 3. å®ç°å®ä½“ç±»

```java
// ç”¨æˆ·å®ä½“å®ç°
public class UserEntity extends BaseAbilityEntity implements UserEntityFacade {
    
    // ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
    public String userId;
    public String nickName;
    public Integer level;
    public Long exp;
    public Integer sex;
    public String avatar;
    
    // æ¸¸æˆæ•°æ®
    public Map<String, Object> gameData = new HashMap<>();
    public List<ItemInfo> items = new ArrayList<>();
    public List<AchievementInfo> achievements = new ArrayList<>();
    
    // æ—¶é—´ä¿¡æ¯
    public Long lastLoginTime;
    public Long lastLogoutTime;
    public Long createTime;
    
    // æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯
    @Override
    public Homo<QueryUserInfoResp> queryUserInfo(QueryUserInfoReq request) {
        log.info("æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯: userId={}", userId);
        
        QueryUserInfoResp resp = QueryUserInfoResp.newBuilder()
            .setUserId(userId)
            .setNickName(nickName)
            .setLevel(level)
            .setExp(exp)
            .setSex(sex)
            .setAvatar(avatar)
            .setLastLoginTime(lastLoginTime)
            .build();
        
        return Homo.result(resp);
    }
    
    // è¿›å…¥æ¸¸æˆ
    @Override
    public Homo<EnterGameResp> enterGame(EnterGameReq request) {
        log.info("ç”¨æˆ·è¿›å…¥æ¸¸æˆ: userId={}", userId);
        
        lastLoginTime = System.currentTimeMillis();
        
        // æ›´æ–°æ¸¸æˆæ•°æ®
        gameData.put("currentScene", request.getSceneId());
        gameData.put("loginTime", lastLoginTime);
        
        EnterGameResp resp = EnterGameResp.newBuilder()
            .setUserId(userId)
            .setSceneId(request.getSceneId())
            .setLoginTime(lastLoginTime)
            .build();
        
        return Homo.result(resp);
    }
    
    // ç¦»å¼€æ¸¸æˆ
    @Override
    public Homo<LeaveGameResp> leaveGame(LeaveGameReq request) {
        log.info("ç”¨æˆ·ç¦»å¼€æ¸¸æˆ: userId={}", userId);
        
        lastLogoutTime = System.currentTimeMillis();
        
        // æ¸…ç†æ¸¸æˆæ•°æ®
        gameData.remove("currentScene");
        
        LeaveGameResp resp = LeaveGameResp.newBuilder()
            .setUserId(userId)
            .setLogoutTime(lastLogoutTime)
            .build();
        
        return Homo.result(resp);
    }
    
    // æ›´æ–°ç­‰çº§
    @Override
    public Homo<UpdateLevelResp> updateLevel(UpdateLevelReq request) {
        log.info("æ›´æ–°ç”¨æˆ·ç­‰çº§: userId={}, newLevel={}", userId, request.getNewLevel());
        
        int oldLevel = level;
        level = request.getNewLevel();
        
        // ç­‰çº§æå‡å¥–åŠ±
        if (level > oldLevel) {
            giveLevelUpReward(oldLevel, level);
        }
        
        UpdateLevelResp resp = UpdateLevelResp.newBuilder()
            .setUserId(userId)
            .setOldLevel(oldLevel)
            .setNewLevel(level)
            .build();
        
        return Homo.result(resp);
    }
    
    // æ·»åŠ ç‰©å“
    @Override
    public Homo<AddItemResp> addItem(AddItemReq request) {
        log.info("æ·»åŠ ç‰©å“: userId={}, itemId={}, count={}", userId, request.getItemId(), request.getCount());
        
        ItemInfo newItem = ItemInfo.builder()
            .itemId(request.getItemId())
            .count(request.getCount())
            .addTime(System.currentTimeMillis())
            .build();
        
        items.add(newItem);
        
        AddItemResp resp = AddItemResp.newBuilder()
            .setUserId(userId)
            .setItemId(request.getItemId())
            .setCount(request.getCount())
            .setTotalCount(items.size())
            .build();
        
        return Homo.result(resp);
    }
    
    // ç­‰çº§æå‡å¥–åŠ±
    private void giveLevelUpReward(int oldLevel, int newLevel) {
        // æ ¹æ®ç­‰çº§å·®ç»™äºˆå¥–åŠ±
        int levelDiff = newLevel - oldLevel;
        long expReward = levelDiff * 1000L;
        
        exp += expReward;
        log.info("ç­‰çº§æå‡å¥–åŠ±: userId={}, expReward={}", userId, expReward);
    }
}
```

### 4. æ³¨å†Œå®ä½“ç®¡ç†å™¨

```java
@Service
public class EntityService extends BaseService {
    
    @Autowired
    private StorageEntityMgr entityMgr;
    
    @Override
    public void afterServerInit() {
        // æ³¨å†Œå®ä½“åˆ›å»ºå¤„ç†å™¨
        entityMgr.registerEntityNotFoundProcess(UserEntity.class, 
            (entityClass, entityId) -> entityMgr.createEntityPromise(entityClass, entityId));
        
        log.info("å®ä½“æœåŠ¡åˆå§‹åŒ–å®Œæˆ");
    }
}
```

### 5. å®¢æˆ·ç«¯è°ƒç”¨å®ä½“

```java
@Service
public class GameClientService extends BaseService {
    
    @Autowired
    private EntityProxyFactory entityProxyFactory;
    
    // è°ƒç”¨ç”¨æˆ·å®ä½“æ–¹æ³•
    public Homo<UserInfo> getUserInfo(String userId) {
        UserEntityFacade userEntity = entityProxyFactory.getEntityProxy(
            EntityServiceFacade.class, 
            UserEntityFacade.class, 
            userId
        );
        
        QueryUserInfoReq request = QueryUserInfoReq.newBuilder()
            .setUserId(userId)
            .build();
        
        return userEntity.queryUserInfo(request)
            .nextDo(resp -> {
                UserInfo userInfo = UserInfo.newBuilder()
                    .setUserId(resp.getUserId())
                    .setNickName(resp.getNickName())
                    .setLevel(resp.getLevel())
                    .setExp(resp.getExp())
                    .build();
                return Homo.result(userInfo);
            });
    }
    
    // ç”¨æˆ·è¿›å…¥æ¸¸æˆ
    public Homo<Boolean> enterGame(String userId, String sceneId) {
        UserEntityFacade userEntity = entityProxyFactory.getEntityProxy(
            EntityServiceFacade.class,
            UserEntityFacade.class,
            userId
        );
        
        EnterGameReq request = EnterGameReq.newBuilder()
            .setUserId(userId)
            .setSceneId(sceneId)
            .build();
        
        return userEntity.enterGame(request)
            .nextDo(resp -> {
                log.info("ç”¨æˆ·è¿›å…¥æ¸¸æˆæˆåŠŸ: userId={}, sceneId={}", userId, sceneId);
                return Homo.result(true);
            });
    }
}
```

## æ ¸å¿ƒæ³¨è§£

### @EntityType

å®šä¹‰å®ä½“ç±»å‹ï¼š

```java
@EntityType(type = "entity-type-name")
public interface EntityFacade {
    // å®ä½“æ–¹æ³•å®šä¹‰
}
```

### @StorageTime

é…ç½®å®ä½“å­˜å‚¨æ—¶é—´é—´éš”ï¼š

```java
@StorageTime(10000)  // 10ç§’è½åœ°ä¸€æ¬¡
public interface EntityFacade {
    // å®ä½“æ–¹æ³•å®šä¹‰
}
```

### @CacheTime

é…ç½®å®ä½“ç¼“å­˜æ—¶é—´ï¼š

```java
@CacheTime(20000)    // 20ç§’ç¼“å­˜æ—¶é—´
public interface EntityFacade {
    // å®ä½“æ–¹æ³•å®šä¹‰
}
```

## å®ä½“ç”Ÿå‘½å‘¨æœŸ

### 1. å®ä½“åˆ›å»º

```java
// è‡ªåŠ¨åˆ›å»ºå®ä½“
public Homo<UserEntity> createUserEntity(String userId) {
    return entityMgr.createEntityPromise(UserEntity.class, userId)
        .nextDo(entity -> {
            // åˆå§‹åŒ–å®ä½“æ•°æ®
            entity.userId = userId;
            entity.nickName = "Guest_" + userId;
            entity.level = 1;
            entity.exp = 0L;
            entity.createTime = System.currentTimeMillis();
            
            log.info("åˆ›å»ºç”¨æˆ·å®ä½“: userId={}", userId);
            return Homo.result(entity);
        });
}
```

### 2. å®ä½“åŠ è½½

```java
// ä»å­˜å‚¨åŠ è½½å®ä½“
public Homo<UserEntity> loadUserEntity(String userId) {
    return entityMgr.getEntityPromise(UserEntity.class, userId)
        .nextDo(entity -> {
            if (entity != null) {
                log.info("åŠ è½½ç”¨æˆ·å®ä½“: userId={}", userId);
            } else {
                log.warn("ç”¨æˆ·å®ä½“ä¸å­˜åœ¨: userId={}", userId);
            }
            return Homo.result(entity);
        });
}
```

### 3. å®ä½“é”€æ¯

```java
// é”€æ¯å®ä½“
public Homo<Void> destroyUserEntity(String userId) {
    return entityMgr.destroyEntityPromise(UserEntity.class, userId)
        .nextDo(result -> {
            log.info("é”€æ¯ç”¨æˆ·å®ä½“: userId={}", userId);
            return Homo.resultVoid();
        });
}
```

## å®ä½“èƒ½åŠ›ç³»ç»Ÿ

### 1. åŸºç¡€èƒ½åŠ›

```java
// æ—¶é—´èƒ½åŠ›
public interface TimeAble {
    void updateTime();
    long getCurrentTime();
}

// è°ƒç”¨èƒ½åŠ›
public interface CallAble {
    Homo<Object> callMethod(String methodName, Object... args);
}

// å­˜å‚¨èƒ½åŠ›
public interface SaveAble {
    Homo<Boolean> save();
    Homo<Boolean> load();
}
```

### 2. è‡ªå®šä¹‰èƒ½åŠ›

```java
// ç”¨æˆ·èƒ½åŠ›
public class UserAbility extends AbstractAbility {
    
    public void updateUserLevel(int newLevel) {
        UserEntity user = (UserEntity) getOwner();
        user.level = newLevel;
        log.info("ç”¨æˆ·ç­‰çº§æ›´æ–°: userId={}, level={}", user.userId, newLevel);
    }
    
    public void addUserExp(long exp) {
        UserEntity user = (UserEntity) getOwner();
        user.exp += exp;
        log.info("ç”¨æˆ·ç»éªŒå¢åŠ : userId={}, exp={}", user.userId, exp);
    }
}

// ç‰©å“èƒ½åŠ›
public class ItemAbility extends AbstractAbility {
    
    public void addItem(String itemId, int count) {
        UserEntity user = (UserEntity) getOwner();
        ItemInfo item = new ItemInfo(itemId, count, System.currentTimeMillis());
        user.items.add(item);
        log.info("æ·»åŠ ç‰©å“: userId={}, itemId={}, count={}", user.userId, itemId, count);
    }
    
    public void removeItem(String itemId, int count) {
        UserEntity user = (UserEntity) getOwner();
        user.items.removeIf(item -> 
            item.getItemId().equals(itemId) && item.getCount() >= count);
        log.info("ç§»é™¤ç‰©å“: userId={}, itemId={}, count={}", user.userId, itemId, count);
    }
}
```

### 3. èƒ½åŠ›ç®¡ç†

```java
@Service
public class AbilityManager {
    
    @Autowired
    private StorageEntityMgr entityMgr;
    
    public void attachAbilities(UserEntity userEntity) {
        // é™„åŠ ç”¨æˆ·èƒ½åŠ›
        UserAbility userAbility = new UserAbility();
        userAbility.attach(userEntity);
        
        // é™„åŠ ç‰©å“èƒ½åŠ›
        ItemAbility itemAbility = new ItemAbility();
        itemAbility.attach(userEntity);
        
        log.info("ä¸ºç”¨æˆ·é™„åŠ èƒ½åŠ›: userId={}", userEntity.userId);
    }
}
```

## å®ä½“å­˜å‚¨é…ç½®

### 1. å­˜å‚¨æ—¶é—´é…ç½®

```java
// å…¨å±€é…ç½®
@Configuration
public class EntityStorageConfig {
    
    @Bean
    public AbilityProperties abilityProperties() {
        AbilityProperties properties = new AbilityProperties();
        properties.setIntervalSecondMillis(1000);        // 1ç§’æ›´æ–°ä¸€æ¬¡
        properties.setCacheTimeSecondMillis(20000);      // 20ç§’ç¼“å­˜
        properties.setSaveTimeSecondMills(60000);        // 60ç§’è½åœ°
        return properties;
    }
}
```

### 2. å®ä½“ç‰¹å®šé…ç½®

```java
// ç”¨æˆ·å®ä½“ï¼šé¢‘ç¹æ›´æ–°ï¼ŒçŸ­ç¼“å­˜æ—¶é—´
@EntityType(type = "user-entity")
@StorageTime(5000)   // 5ç§’è½åœ°
@CacheTime(10000)    // 10ç§’ç¼“å­˜
public interface UserEntityFacade {
    // ç”¨æˆ·å®ä½“æ–¹æ³•
}

// é…ç½®å®ä½“ï¼šå¾ˆå°‘æ›´æ–°ï¼Œé•¿ç¼“å­˜æ—¶é—´
@EntityType(type = "config-entity")
@StorageTime(300000) // 5åˆ†é’Ÿè½åœ°
@CacheTime(600000)   // 10åˆ†é’Ÿç¼“å­˜
public interface ConfigEntityFacade {
    // é…ç½®å®ä½“æ–¹æ³•
}
```

## è¿œç¨‹è°ƒç”¨

### 1. å®ä½“ä»£ç†

```java
@Service
public class EntityProxyService {
    
    @Autowired
    private EntityProxyFactory entityProxyFactory;
    
    // è·å–å®ä½“ä»£ç†
    public <T> T getEntityProxy(Class<?> serviceClass, Class<T> entityClass, String entityId) {
        return entityProxyFactory.getEntityProxy(serviceClass, entityClass, entityId);
    }
    
    // è°ƒç”¨å®ä½“æ–¹æ³•
    public <T> Homo<T> callEntityMethod(Class<?> serviceClass, Class<?> entityClass, 
                                       String entityId, String methodName, Object... args) {
        Object entityProxy = getEntityProxy(serviceClass, entityClass, entityId);
        return callMethod(entityProxy, methodName, args);
    }
}
```

### 2. è·¨æœåŠ¡è°ƒç”¨

```java
@Service
public class CrossServiceEntityCall {
    
    @Autowired
    private EntityProxyFactory entityProxyFactory;
    
    // è·¨æœåŠ¡è°ƒç”¨ç”¨æˆ·å®ä½“
    public Homo<UserInfo> callRemoteUserEntity(String userId) {
        UserEntityFacade userEntity = entityProxyFactory.getEntityProxy(
            "user-service",           // ç›®æ ‡æœåŠ¡
            UserEntityFacade.class,   // å®ä½“æ¥å£
            userId                    // å®ä½“ID
        );
        
        QueryUserInfoReq request = QueryUserInfoReq.newBuilder()
            .setUserId(userId)
            .build();
        
        return userEntity.queryUserInfo(request)
            .nextDo(resp -> {
                UserInfo userInfo = UserInfo.newBuilder()
                    .setUserId(resp.getUserId())
                    .setNickName(resp.getNickName())
                    .setLevel(resp.getLevel())
                    .build();
                return Homo.result(userInfo);
            });
    }
}
```

## æœ€ä½³å®è·µ

### 1. å®ä½“è®¾è®¡

```java
// âœ… å¥½çš„åšæ³•ï¼šæ¸…æ™°çš„å®ä½“ç»“æ„
public class UserEntity extends BaseAbilityEntity implements UserEntityFacade {
    // åŸºç¡€æ•°æ®
    public String userId;
    public String nickName;
    public Integer level;
    
    // ä¸šåŠ¡æ•°æ®
    public Map<String, Object> gameData = new HashMap<>();
    public List<ItemInfo> items = new ArrayList<>();
    
    // æ—¶é—´æˆ³
    public Long createTime;
    public Long updateTime;
}

// âŒ é¿å…ï¼šæ··ä¹±çš„å®ä½“ç»“æ„
public class BadUserEntity extends BaseAbilityEntity {
    public Object data;  // ä½¿ç”¨ Object ç±»å‹
    public Map<String, Object> everything;  // æ‰€æœ‰æ•°æ®æ”¾åœ¨ä¸€ä¸ª Map ä¸­
}
```

### 2. æ–¹æ³•è®¾è®¡

```java
// âœ… å¥½çš„åšæ³•ï¼šæ¸…æ™°çš„æ–¹æ³•ç­¾å
public Homo<QueryUserInfoResp> queryUserInfo(QueryUserInfoReq request) {
    // æ–¹æ³•å®ç°
}

// âŒ é¿å…ï¼šæ¨¡ç³Šçš„æ–¹æ³•ç­¾å
public Homo<Object> doSomething(Object request) {
    // æ–¹æ³•å®ç°
}
```

### 3. é”™è¯¯å¤„ç†

```java
// âœ… å¥½çš„åšæ³•ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†
public Homo<UpdateLevelResp> updateLevel(UpdateLevelReq request) {
    try {
        if (request.getNewLevel() <= level) {
            return Homo.error(new IllegalArgumentException("æ–°ç­‰çº§å¿…é¡»å¤§äºå½“å‰ç­‰çº§"));
        }
        
        int oldLevel = level;
        level = request.getNewLevel();
        
        UpdateLevelResp resp = UpdateLevelResp.newBuilder()
            .setUserId(userId)
            .setOldLevel(oldLevel)
            .setNewLevel(level)
            .build();
        
        return Homo.result(resp);
    } catch (Exception e) {
        log.error("æ›´æ–°ç­‰çº§å¤±è´¥: userId={}", userId, e);
        return Homo.error(e);
    }
}
```

### 4. æ€§èƒ½ä¼˜åŒ–

```java
// âœ… ä½¿ç”¨æ‰¹é‡æ“ä½œ
public Homo<Boolean> batchUpdateItems(List<ItemInfo> items) {
    this.items.addAll(items);
    return Homo.result(true);
}

// âœ… å‡å°‘ä¸å¿…è¦çš„å­˜å‚¨
public Homo<Boolean> updateLastLoginTime() {
    lastLoginTime = System.currentTimeMillis();
    // åªæ›´æ–°å¿…è¦å­—æ®µï¼Œä¸è§¦å‘å®Œæ•´å­˜å‚¨
    return Homo.result(true);
}
```

## ç›‘æ§å’Œè°ƒè¯•

### 1. å®ä½“ç›‘æ§

```java
@Component
public class EntityMonitor {
    
    private final MeterRegistry meterRegistry;
    
    public EntityMonitor(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
    }
    
    public void recordEntityCall(String entityType, String methodName, boolean success) {
        Counter.builder("entity.calls")
            .tag("entityType", entityType)
            .tag("method", methodName)
            .tag("success", String.valueOf(success))
            .register(meterRegistry)
            .increment();
    }
    
    public void recordEntityStorage(String entityType, boolean success) {
        Counter.builder("entity.storage")
            .tag("entityType", entityType)
            .tag("success", String.valueOf(success))
            .register(meterRegistry)
            .increment();
    }
}
```

### 2. å¥åº·æ£€æŸ¥

```java
@RestController
public class EntityHealthController {
    
    @Autowired
    private StorageEntityMgr entityMgr;
    
    @GetMapping("/health/entity")
    public Map<String, Object> checkEntityHealth() {
        Map<String, Object> health = new HashMap<>();
        
        try {
            // æ£€æŸ¥å®ä½“ç®¡ç†å™¨çŠ¶æ€
            health.put("entityManager", "UP");
            health.put("entityCount", entityMgr.getEntityCount());
        } catch (Exception e) {
            health.put("entityManager", "DOWN");
            health.put("error", e.getMessage());
        }
        
        return health;
    }
}
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å®ä½“åˆ›å»ºå¤±è´¥**
   - æ£€æŸ¥å®ä½“ç±»æ˜¯å¦æ­£ç¡®ç»§æ‰¿ BaseAbilityEntity
   - ç¡®è®¤å®ä½“æ¥å£æ˜¯å¦æ­£ç¡®å®ç°
   - æŸ¥çœ‹å®ä½“ç®¡ç†å™¨æ³¨å†ŒçŠ¶æ€

2. **è¿œç¨‹è°ƒç”¨å¤±è´¥**
   - æ£€æŸ¥æœåŠ¡å‘ç°é…ç½®
   - ç¡®è®¤ç›®æ ‡æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
   - æŸ¥çœ‹ç½‘ç»œè¿æ¥çŠ¶æ€

3. **å­˜å‚¨å¤±è´¥**
   - æ£€æŸ¥æ•°æ®åº“è¿æ¥é…ç½®
   - ç¡®è®¤å®ä½“æ•°æ®æ˜¯å¦å¯åºåˆ—åŒ–
   - æŸ¥çœ‹å­˜å‚¨é©±åŠ¨çŠ¶æ€

### è°ƒè¯•æŠ€å·§

```java
// å¯ç”¨å®ä½“è°ƒè¯•æ—¥å¿—
logging.level.com.homo.core.entity=DEBUG
logging.level.com.homo.core.ability=DEBUG

// æ·»åŠ å®ä½“è¿½è¸ª
@Component
public class EntityTracer {
    
    public void traceEntityCall(String entityType, String methodName, Object... args) {
        log.debug("å®ä½“è°ƒç”¨: type={}, method={}, args={}", entityType, methodName, args);
    }
}
```

## ç›¸å…³é“¾æ¥

- [homo-core æ¡†æ¶æ–‡æ¡£](../README.md)
- [é¢†åŸŸé©±åŠ¨è®¾è®¡æŒ‡å—](https://martinfowler.com/bliki/DomainDrivenDesign.html)
- [å“åº”å¼ç¼–ç¨‹æŒ‡å—](https://projectreactor.io/docs/core/release/reference/)
- [Spring Boot å®˜æ–¹æ–‡æ¡£](https://spring.io/projects/spring-boot)
