# æ¶ˆæ¯é˜Ÿåˆ—ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

homo-core æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å—æä¾›äº†ç»Ÿä¸€çš„æ¶ˆæ¯å‘å¸ƒè®¢é˜…èƒ½åŠ›ï¼Œæ”¯æŒ Kafkaã€Redis ç­‰å¤šç§æ¶ˆæ¯é˜Ÿåˆ—å®ç°ã€‚é€šè¿‡æŠ½è±¡åŒ–çš„æ¥å£è®¾è®¡ï¼Œå±è”½äº†åº•å±‚æ¶ˆæ¯é˜Ÿåˆ—çš„å·®å¼‚ï¼Œä¸ºæ¸¸æˆæœåŠ¡å™¨æä¾›äº†å¯é çš„æ¶ˆæ¯é€šä¿¡æœºåˆ¶ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸš€ **å¤šåè®®æ”¯æŒ**: æ”¯æŒ Kafkaã€Redis ç­‰å¤šç§æ¶ˆæ¯é˜Ÿåˆ—
- ğŸ“¨ **å‘å¸ƒè®¢é˜…**: æ”¯æŒæ¶ˆæ¯çš„å‘å¸ƒå’Œè®¢é˜…æ¨¡å¼
- ğŸ”„ **è´Ÿè½½å‡è¡¡**: æ”¯æŒæ¶ˆè´¹è€…ç»„å’Œåˆ†åŒºè´Ÿè½½å‡è¡¡
- ğŸ›¡ï¸ **å¯é æ€§**: æ”¯æŒæ¶ˆæ¯ç¡®è®¤å’Œé‡è¯•æœºåˆ¶
- ğŸ¯ **ç±»å‹å®‰å…¨**: æ”¯æŒå¼ºç±»å‹æ¶ˆæ¯ç¼–è§£ç 
- âš¡ **é«˜æ€§èƒ½**: åŸºäºå“åº”å¼ç¼–ç¨‹ï¼Œæ”¯æŒé«˜å¹¶å‘åœºæ™¯

## ç¯å¢ƒè¦æ±‚

- **JDK**: 8 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Kafka**: 2.8 æˆ–æ›´é«˜ç‰ˆæœ¬ (å¯é€‰)
- **Redis**: 3.0 æˆ–æ›´é«˜ç‰ˆæœ¬ (å¯é€‰)
- **Maven**: 3.6.0 æˆ–æ›´é«˜ç‰ˆæœ¬

## å¿«é€Ÿå¼€å§‹

### 1. æ·»åŠ ä¾èµ–

#### ç”Ÿäº§è€…ä¾èµ–

```xml
<dependencies>
    <!-- æ¶ˆæ¯é˜Ÿåˆ—ç”Ÿäº§è€… -->
    <dependency>
        <groupId>com.homo</groupId>
        <artifactId>homo-core-mq-producer</artifactId>
    </dependency>
    
    <!-- Kafka é©±åŠ¨ -->
    <dependency>
        <groupId>com.homo</groupId>
        <artifactId>homo-core-mq-driver-kafka</artifactId>
    </dependency>
</dependencies>
```

#### æ¶ˆè´¹è€…ä¾èµ–

```xml
<dependencies>
    <!-- æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹è€… -->
    <dependency>
        <groupId>com.homo</groupId>
        <artifactId>homo-core-mq-consumer</artifactId>
    </dependency>
    
    <!-- Kafka é©±åŠ¨ -->
    <dependency>
        <groupId>com.homo</groupId>
        <artifactId>homo-core-mq-driver-kafka</artifactId>
    </dependency>
</dependencies>
```

### 2. é…ç½®æ¶ˆæ¯é˜Ÿåˆ—

åœ¨ `application.properties` ä¸­é…ç½®ï¼š

```properties
# Apollo é…ç½®
apollo.bootstrap.enabled=true
apollo.bootstrap.namespaces=application,homo_mq_kafka

# Kafka é…ç½®
homo.mq.kafka.bootstrap.servers=localhost:9092
homo.mq.kafka.consumer.auto.commit=true
homo.mq.kafka.acks=all
homo.mq.kafka.retries=3
```

### 3. åˆ›å»ºç”Ÿäº§è€…

```java
@Service
public class MessageProducerService implements ServiceModule {
    
    @Autowired
    private MQProducerFactory mqProducerFactory;
    
    private MQProducer mqProducer;
    
    @Override
    public void afterAllModuleInit() {
        // åˆ›å»ºç”Ÿäº§è€…
        MQProducerConfig config = new MQProducerConfig(
            MQType.KAFKA, 
            "game-server", 
            "region-1", 
            TopicResolveStrategyEnum.APPEND_APP_ID_SERVER_ID
        );
        mqProducer = mqProducerFactory.create(config);
    }
    
    // å‘é€æ¶ˆæ¯
    public void sendMessage(String topic, Object message) {
        try {
            mqProducer.send(topic, message);
            log.info("æ¶ˆæ¯å‘é€æˆåŠŸ: topic={}, message={}", topic, message);
        } catch (Exception e) {
            log.error("æ¶ˆæ¯å‘é€å¤±è´¥: topic={}, message={}", topic, message, e);
        }
    }
}
```

### 4. åˆ›å»ºæ¶ˆè´¹è€…

```java
@Service
public class MessageConsumerService implements SinkHandler, ServiceModule {
    
    @Autowired
    private MQConsumerFactory mqConsumerFactory;
    
    @Autowired
    private RootModule rootModule;
    
    private MQConsumer mqConsumer;
    
    @Override
    public void moduleInit() {
        // åˆ›å»ºæ¶ˆè´¹è€…
        String appId = rootModule.getServerInfo().getAppId();
        String regionId = rootModule.getServerInfo().getRegionId();
        MQConsumerConfig config = new MQConsumerConfig(
            MQType.KAFKA, 
            appId, 
            regionId, 
            "game-consumer-group",
            TopicResolveStrategyEnum.APPEND_APP_ID_SERVER_ID
        );
        mqConsumer = mqConsumerFactory.create(config);
    }
    
    @Override
    public void afterAllModuleInit() {
        // æ³¨å†Œæ¶ˆè´¹è€…å¹¶å¯åŠ¨
        mqConsumer.addReceiver(this);
        mqConsumer.start();
    }
    
    // å¤„ç†ç”¨æˆ·ç™»å½•æ¶ˆæ¯
    @SinkFunc(topics = {"user.login"})
    public void handleUserLogin(String topic, UserLoginMessage message, ConsumerCallback callback) {
        log.info("æ”¶åˆ°ç”¨æˆ·ç™»å½•æ¶ˆæ¯: {}", message);
        
        try {
            // å¤„ç†ä¸šåŠ¡é€»è¾‘
            processUserLogin(message);
            callback.confirm();
        } catch (Exception e) {
            log.error("å¤„ç†ç”¨æˆ·ç™»å½•æ¶ˆæ¯å¤±è´¥", e);
            callback.confirm(); // ç¡®è®¤æ¶ˆæ¯ï¼Œé¿å…é‡å¤å¤„ç†
        }
    }
    
    // å¤„ç†è®¢å•æ¶ˆæ¯
    @SinkFunc(topics = {"order.created", "order.paid"})
    public void handleOrderMessage(String topic, OrderMessage message, ConsumerCallback callback) {
        log.info("æ”¶åˆ°è®¢å•æ¶ˆæ¯: topic={}, message={}", topic, message);
        
        try {
            if ("order.created".equals(topic)) {
                processOrderCreated(message);
            } else if ("order.paid".equals(topic)) {
                processOrderPaid(message);
            }
            callback.confirm();
        } catch (Exception e) {
            log.error("å¤„ç†è®¢å•æ¶ˆæ¯å¤±è´¥: topic={}", topic, e);
            callback.confirm();
        }
    }
}
```

## æ ¸å¿ƒæ¦‚å¿µ

### æ¶ˆæ¯é˜Ÿåˆ—ç±»å‹

```java
public enum MQType {
    KAFKA,  // Apache Kafka
    REDIS   // Redis Pub/Sub
}
```

### Topic è§£æç­–ç•¥

```java
public enum TopicResolveStrategyEnum implements TopicResolveStrategy {
    
    // åŸå§‹ Topic åç§°
    DEFAULT {
        @Override
        public String getRealTopic(String originTopic, String appId, String regionId) {
            return originTopic;
        }
    },
    
    // Topic + AppId
    APPEND_APP_ID {
        @Override
        public String getRealTopic(String originTopic, String appId, String regionId) {
            return String.format("%s-%s", originTopic, appId);
        }
    },
    
    // Topic + AppId + RegionId
    APPEND_APP_ID_SERVER_ID {
        @Override
        public String getRealTopic(String originTopic, String appId, String regionId) {
            return String.format("%s-%s-%s", originTopic, appId, regionId);
        }
    }
}
```

### æ¶ˆæ¯ç¼–è§£ç 

```java
// è‡ªå®šä¹‰æ¶ˆæ¯ç¼–è§£ç å™¨
@Component
public class UserMessageCodec implements MQCodeC<UserMessage, byte[]> {
    
    @Override
    public byte[] encode(UserMessage message) {
        return JSON.toJSONBytes(message);
    }
    
    @Override
    public UserMessage decode(byte[] data) {
        return JSON.parseObject(data, UserMessage.class);
    }
}

// æ³¨å†Œç¼–è§£ç å™¨
@PostConstruct
public void registerCodec() {
    mqProducer.registerCodec("user.message", new UserMessageCodec());
    mqConsumer.registerCodec("user.message", new UserMessageCodec());
}
```

## ç”Ÿäº§è€…ä½¿ç”¨

### åŸºæœ¬å‘é€

```java
@Service
public class GameEventProducer {
    
    @Autowired
    private MQProducer mqProducer;
    
    // å‘é€ç®€å•æ¶ˆæ¯
    public void sendPlayerLogin(String playerId) {
        PlayerLoginEvent event = new PlayerLoginEvent(playerId, System.currentTimeMillis());
        try {
            mqProducer.send("player.login", event);
        } catch (Exception e) {
            log.error("å‘é€ç©å®¶ç™»å½•äº‹ä»¶å¤±è´¥", e);
        }
    }
    
    // å‘é€å¸¦ Key çš„æ¶ˆæ¯
    public void sendPlayerAction(String playerId, String action) {
        PlayerActionEvent event = new PlayerActionEvent(playerId, action);
        try {
            mqProducer.send("player.action", playerId, event);
        } catch (Exception e) {
            log.error("å‘é€ç©å®¶è¡Œä¸ºäº‹ä»¶å¤±è´¥", e);
        }
    }
    
    // å‘é€å¸¦å›è°ƒçš„æ¶ˆæ¯
    public void sendOrderEvent(OrderEvent event) {
        try {
            mqProducer.send("order.created", event, new ProducerCallback() {
                @Override
                public void onCompletion(boolean success, Throwable throwable) {
                    if (success) {
                        log.info("è®¢å•äº‹ä»¶å‘é€æˆåŠŸ: {}", event.getOrderId());
                    } else {
                        log.error("è®¢å•äº‹ä»¶å‘é€å¤±è´¥: {}", event.getOrderId(), throwable);
                    }
                }
            });
        } catch (Exception e) {
            log.error("å‘é€è®¢å•äº‹ä»¶å¤±è´¥", e);
        }
    }
}
```

### æ‰¹é‡å‘é€

```java
@Service
public class BatchMessageProducer {
    
    @Autowired
    private MQProducer mqProducer;
    
    public void sendBatchMessages(List<GameEvent> events) {
        for (GameEvent event : events) {
            try {
                mqProducer.send(event.getTopic(), event);
            } catch (Exception e) {
                log.error("æ‰¹é‡å‘é€æ¶ˆæ¯å¤±è´¥: {}", event, e);
            }
        }
    }
    
    // ä½¿ç”¨ CompletableFuture å¹¶å‘å‘é€
    public CompletableFuture<Void> sendBatchMessagesAsync(List<GameEvent> events) {
        List<CompletableFuture<Void>> futures = events.stream()
            .map(event -> CompletableFuture.runAsync(() -> {
                try {
                    mqProducer.send(event.getTopic(), event);
                } catch (Exception e) {
                    log.error("å¼‚æ­¥å‘é€æ¶ˆæ¯å¤±è´¥: {}", event, e);
                }
            }))
            .collect(Collectors.toList());
        
        return CompletableFuture.allOf(futures.toArray(new CompletableFuture[0]));
    }
}
```

## æ¶ˆè´¹è€…ä½¿ç”¨

### æ³¨è§£æ–¹å¼æ¶ˆè´¹

```java
@Service
public class GameEventConsumer implements SinkHandler, ServiceModule {
    
    @Autowired
    private MQConsumer mqConsumer;
    
    @Override
    public void afterAllModuleInit() {
        mqConsumer.addReceiver(this);
        mqConsumer.start();
    }
    
    // å¤„ç†ç©å®¶äº‹ä»¶
    @SinkFunc(topics = {"player.login", "player.logout"})
    public void handlePlayerEvent(String topic, PlayerEvent event, ConsumerCallback callback) {
        try {
            if ("player.login".equals(topic)) {
                handlePlayerLogin(event);
            } else if ("player.logout".equals(topic)) {
                handlePlayerLogout(event);
            }
            callback.confirm();
        } catch (Exception e) {
            log.error("å¤„ç†ç©å®¶äº‹ä»¶å¤±è´¥: topic={}", topic, e);
            callback.confirm();
        }
    }
    
    // å¤„ç†æ¸¸æˆäº‹ä»¶
    @SinkFunc(topics = {"game.start", "game.end"})
    public void handleGameEvent(String topic, GameEvent event, ConsumerCallback callback) {
        try {
            processGameEvent(event);
            callback.confirm();
        } catch (Exception e) {
            log.error("å¤„ç†æ¸¸æˆäº‹ä»¶å¤±è´¥: topic={}", topic, e);
            callback.confirm();
        }
    }
    
    private void handlePlayerLogin(PlayerEvent event) {
        log.info("ç©å®¶ç™»å½•: {}", event.getPlayerId());
        // å¤„ç†ç™»å½•é€»è¾‘
    }
    
    private void handlePlayerLogout(PlayerEvent event) {
        log.info("ç©å®¶ç™»å‡º: {}", event.getPlayerId());
        // å¤„ç†ç™»å‡ºé€»è¾‘
    }
}
```

### å‡½æ•°å¼æ¶ˆè´¹

```java
@Service
public class FunctionalConsumer implements ServiceModule {
    
    @Autowired
    private MQConsumer mqConsumer;
    
    @Override
    public void afterAllModuleInit() {
        // ä½¿ç”¨ ReceiverSink å¤„ç†æ¶ˆæ¯
        ReceiverSink<PlayerEvent> playerEventSink = new ReceiverSink<PlayerEvent>() {
            @Override
            public void onSink(String topic, PlayerEvent message, ConsumerCallback callback) {
                try {
                    processPlayerEvent(topic, message);
                    callback.confirm();
                } catch (Exception e) {
                    log.error("å¤„ç†ç©å®¶äº‹ä»¶å¤±è´¥: topic={}", topic, e);
                    callback.confirm();
                }
            }
        };
        
        mqConsumer.addReceiver("player.events", playerEventSink);
        mqConsumer.start();
    }
    
    private void processPlayerEvent(String topic, PlayerEvent event) {
        log.info("å¤„ç†ç©å®¶äº‹ä»¶: topic={}, event={}", topic, event);
        // å¤„ç†ä¸šåŠ¡é€»è¾‘
    }
}
```

### é”™è¯¯å¤„ç†

```java
@Service
public class ErrorHandlingConsumer implements SinkHandler, ServiceModule {
    
    @Autowired
    private MQConsumer mqConsumer;
    
    @Override
    public void afterAllModuleInit() {
        // æ·»åŠ é”™è¯¯ç›‘å¬å™¨
        mqConsumer.addErrorListener(new ErrorListener() {
            @Override
            public void onError(String topic, byte[] message, Throwable throwable) {
                log.error("æ¶ˆæ¯å¤„ç†é”™è¯¯: topic={}, message={}", topic, new String(message), throwable);
                // å¯ä»¥åœ¨è¿™é‡Œå®ç°é‡è¯•é€»è¾‘æˆ–æ­»ä¿¡é˜Ÿåˆ—
            }
        });
        
        mqConsumer.addReceiver(this);
        mqConsumer.start();
    }
    
    @SinkFunc(topics = {"critical.events"})
    public void handleCriticalEvent(String topic, CriticalEvent event, ConsumerCallback callback) {
        try {
            processCriticalEvent(event);
            callback.confirm();
        } catch (Exception e) {
            log.error("å¤„ç†å…³é”®äº‹ä»¶å¤±è´¥: topic={}", topic, e);
            // æ ¹æ®ä¸šåŠ¡éœ€æ±‚å†³å®šæ˜¯å¦ç¡®è®¤æ¶ˆæ¯
            if (isRetryable(e)) {
                // å¯é‡è¯•çš„é”™è¯¯ï¼Œä¸ç¡®è®¤æ¶ˆæ¯
                throw e;
            } else {
                // ä¸å¯é‡è¯•çš„é”™è¯¯ï¼Œç¡®è®¤æ¶ˆæ¯é¿å…æ­»å¾ªç¯
                callback.confirm();
            }
        }
    }
    
    private boolean isRetryable(Exception e) {
        return e instanceof TemporaryException || 
               e instanceof NetworkException;
    }
}
```

## é…ç½®è¯¦è§£

### Kafka é…ç½®

```properties
# Kafka æœåŠ¡å™¨åœ°å€
homo.mq.kafka.bootstrap.servers=localhost:9092

# ç”Ÿäº§è€…é…ç½®
homo.mq.kafka.acks=all
homo.mq.kafka.retries=3
homo.mq.kafka.retry.backoff.ms=100
homo.mq.kafka.delivery.timeout.ms=120000
homo.mq.kafka.buffer.memory=33554432
homo.mq.kafka.batch.size=16384
homo.mq.kafka.linger.ms=100

# æ¶ˆè´¹è€…é…ç½®
homo.mq.kafka.consumer.auto.commit=true
homo.mq.kafka.consumer.max.poll.records.size=60
homo.mq.kafka.consumer.poll.wait.millisecond=2000
homo.mq.kafka.key.deserializer=org.apache.kafka.common.serialization.StringDeserializer
homo.mq.kafka.value.deserializer=org.apache.kafka.common.serialization.BytesDeserializer

# çº¿ç¨‹æ± é…ç½®
homo.mq.kafka.producer.pool.core.size=16
homo.mq.kafka.producer.pool.max.size=16
homo.mq.kafka.producer.pool.keepLive.second=60
homo.mq.kafka.producer.queue.capacity=50000
```

### Redis é…ç½®

```properties
# Redis é…ç½®
homo.redis.url=redis://localhost:6379
homo.redis.port=6379
homo.redis.auth=
homo.redis.dataBase=0
homo.redis.timeOutMs=300000
homo.redis.maxTotal=100
homo.redis.maxIdle=10
homo.redis.minIdle=10
homo.redis.maxWaitMillis=-1
homo.redis.testOnBorrow=false
homo.redis.soTimeOut=30000
```

## æœ€ä½³å®è·µ

### 1. Topic å‘½åè§„èŒƒ

```java
// âœ… å¥½çš„åšæ³•ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„ Topic åç§°
public class TopicConstants {
    public static final String USER_LOGIN = "user.login";
    public static final String USER_LOGOUT = "user.logout";
    public static final String ORDER_CREATED = "order.created";
    public static final String ORDER_PAID = "order.paid";
    public static final String GAME_EVENT = "game.event";
}

// âŒ é¿å…ï¼šä½¿ç”¨æ— æ„ä¹‰çš„ Topic åç§°
public class BadTopics {
    public static final String TOPIC1 = "topic1";
    public static final String MSG = "msg";
    public static final String DATA = "data";
}
```

### 2. æ¶ˆæ¯è®¾è®¡

```java
// âœ… å¥½çš„åšæ³•ï¼šè®¾è®¡æ¸…æ™°çš„æ¶ˆæ¯ç»“æ„
@Data
@AllArgsConstructor
@NoArgsConstructor
public class PlayerEvent {
    private String playerId;
    private String eventType;
    private long timestamp;
    private Map<String, Object> properties;
    
    public static PlayerEvent login(String playerId) {
        return new PlayerEvent(playerId, "login", System.currentTimeMillis(), new HashMap<>());
    }
    
    public static PlayerEvent logout(String playerId) {
        return new PlayerEvent(playerId, "logout", System.currentTimeMillis(), new HashMap<>());
    }
}

// âŒ é¿å…ï¼šä½¿ç”¨æ¨¡ç³Šçš„æ¶ˆæ¯ç»“æ„
@Data
public class BadMessage {
    private String data;
    private Object content;
    private String type;
}
```

### 3. é”™è¯¯å¤„ç†

```java
// âœ… å¥½çš„åšæ³•ï¼šå®Œå–„çš„é”™è¯¯å¤„ç†
@SinkFunc(topics = {"user.events"})
public void handleUserEvent(String topic, UserEvent event, ConsumerCallback callback) {
    try {
        processUserEvent(event);
        callback.confirm();
    } catch (TemporaryException e) {
        log.warn("ä¸´æ—¶é”™è¯¯ï¼Œç¨åé‡è¯•: {}", e.getMessage());
        // ä¸ç¡®è®¤æ¶ˆæ¯ï¼Œè®©æ¶ˆæ¯é‡æ–°æŠ•é€’
        throw e;
    } catch (PermanentException e) {
        log.error("æ°¸ä¹…é”™è¯¯ï¼Œä¸¢å¼ƒæ¶ˆæ¯: {}", e.getMessage());
        callback.confirm(); // ç¡®è®¤æ¶ˆæ¯ï¼Œé¿å…æ­»å¾ªç¯
    } catch (Exception e) {
        log.error("æœªçŸ¥é”™è¯¯", e);
        callback.confirm();
    }
}
```

### 4. æ€§èƒ½ä¼˜åŒ–

```java
// âœ… ä½¿ç”¨æ‰¹é‡å¤„ç†æé«˜æ€§èƒ½
@SinkFunc(topics = {"batch.events"})
public void handleBatchEvents(String topic, List<GameEvent> events, ConsumerCallback callback) {
    try {
        // æ‰¹é‡å¤„ç†äº‹ä»¶
        processBatchEvents(events);
        callback.confirm();
    } catch (Exception e) {
        log.error("æ‰¹é‡å¤„ç†äº‹ä»¶å¤±è´¥", e);
        callback.confirm();
    }
}

// âœ… ä½¿ç”¨å¼‚æ­¥å¤„ç†
@SinkFunc(topics = {"async.events"})
public void handleAsyncEvent(String topic, AsyncEvent event, ConsumerCallback callback) {
    CompletableFuture.runAsync(() -> {
        try {
            processAsyncEvent(event);
            callback.confirm();
        } catch (Exception e) {
            log.error("å¼‚æ­¥å¤„ç†äº‹ä»¶å¤±è´¥", e);
            callback.confirm();
        }
    });
}
```

## ç›‘æ§å’Œè°ƒè¯•

### 1. æ¶ˆæ¯ç›‘æ§

```java
@Component
public class MessageMetrics {
    
    private final MeterRegistry meterRegistry;
    
    public MessageMetrics(MeterRegistry meterRegistry) {
        this.meterRegistry = meterRegistry;
    }
    
    public void recordMessageSent(String topic) {
        Counter.builder("mq.messages.sent")
            .tag("topic", topic)
            .register(meterRegistry)
            .increment();
    }
    
    public void recordMessageConsumed(String topic, boolean success) {
        Counter.builder("mq.messages.consumed")
            .tag("topic", topic)
            .tag("success", String.valueOf(success))
            .register(meterRegistry)
            .increment();
    }
    
    public void recordProcessingTime(String topic, Duration duration) {
        Timer.builder("mq.processing.time")
            .tag("topic", topic)
            .register(meterRegistry)
            .record(duration);
    }
}
```

### 2. å¥åº·æ£€æŸ¥

```java
@RestController
public class MessageQueueHealthController {
    
    @Autowired
    private MQProducer mqProducer;
    
    @Autowired
    private MQConsumer mqConsumer;
    
    @GetMapping("/health/mq")
    public Map<String, Object> checkHealth() {
        Map<String, Object> health = new HashMap<>();
        
        // æ£€æŸ¥ç”Ÿäº§è€…çŠ¶æ€
        health.put("producer", Map.of(
            "status", mqProducer != null ? "UP" : "DOWN",
            "type", mqProducer != null ? mqProducer.getType() : "UNKNOWN"
        ));
        
        // æ£€æŸ¥æ¶ˆè´¹è€…çŠ¶æ€
        health.put("consumer", Map.of(
            "status", mqConsumer != null ? mqConsumer.getStatus() : "DOWN",
            "type", mqConsumer != null ? mqConsumer.getType() : "UNKNOWN"
        ));
        
        return health;
    }
}
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ¶ˆæ¯å‘é€å¤±è´¥**
   - æ£€æŸ¥ Kafka æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
   - ç¡®è®¤ Topic æ˜¯å¦å­˜åœ¨
   - æŸ¥çœ‹ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

2. **æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥**
   - æ£€æŸ¥æ¶ˆè´¹è€…ç»„é…ç½®
   - ç¡®è®¤æ¶ˆæ¯æ ¼å¼æ˜¯å¦æ­£ç¡®
   - æŸ¥çœ‹æ¶ˆè´¹è€…æ—¥å¿—

3. **æ€§èƒ½é—®é¢˜**
   - è°ƒæ•´æ‰¹å¤„ç†å¤§å°
   - ä¼˜åŒ–æ¶ˆæ¯å¤„ç†é€»è¾‘
   - æ£€æŸ¥ç½‘ç»œå¸¦å®½å’Œå»¶è¿Ÿ

### è°ƒè¯•æŠ€å·§

```java
// å¯ç”¨è¯¦ç»†æ—¥å¿—
logging.level.com.homo.core.mq=DEBUG
logging.level.org.apache.kafka=DEBUG

// æ·»åŠ æ¶ˆæ¯è¿½è¸ª
@Component
public class MessageTracer {
    
    public void traceMessage(String direction, String topic, Object message) {
        log.debug("Message {}: topic={}, message={}", direction, topic, message);
    }
}
```

## ç›¸å…³é“¾æ¥

- [homo-core æ¡†æ¶æ–‡æ¡£](../README.md)
- [Apache Kafka å®˜æ–¹æ–‡æ¡£](https://kafka.apache.org/documentation/)
- [Redis Pub/Sub æ–‡æ¡£](https://redis.io/docs/manual/pubsub/)
- [å“åº”å¼ç¼–ç¨‹æŒ‡å—](https://projectreactor.io/docs/core/release/reference/)
